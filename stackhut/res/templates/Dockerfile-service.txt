FROM stackhut/{{ service.from_image }}:latest
MAINTAINER "{{ service.author }}" <{{ service.email }}>
LABEL description="{{ service.description }}"

{% if service.os_deps %}
# update the distro and commit
RUN echo "Starting..." && \
    {% for cmd in service.baseos.install_os_pkg(service.os_deps) -%}
    {{ cmd }} && \
    {% endfor -%}
    echo "...done" && exit
{% endif %}

# copy the application itself - needs to be done manually for now
# TODO - fix to handle dirs
COPY {{ service.stack.entrypoint }} {{ service.stack.get_install_stack_file }} {{ service.files|join(' ') }} ./

{% if service.stack.get_install_stack_file %}
# install lang packages needed for stack
RUN {{ service.stack.install_stack_pkgs() }}
{% endif %}

# any other Docker commands
{% for cmd in service.docker_cmds %}
{{ cmd }}
{% endfor %}
